(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();const Q=(n,c,a)=>`
        <button id=${c} role="button" disabled=${a} >${n}</button>
    `;const X=()=>`
        <div id="drop-area" draggable="true">
            <form id="formAction">
                <p>Перетащите фото сюда</p>
                <p>или</p>
                <input type="file" id="fileElem" multiple accept="image/*" >
                <label class="button" for="fileElem">выберите со своего копьютера</label>
            </form>
            <div id="gallery" /></div>
            <p id="maxCountOfPhoto">Максимальное колличество загружаемых файлов - 9.</p>
        </div>
    `,Y=()=>`
        <div class="home-page">
            <div class="home-container">
                <h1>Выберите фото,<br> на которые вы хотели бы наложить водяной знак</h1>
                ${X()}
                ${Q("Далее","nextBtn",!0)}
            </div>
        </div>
    `;document.querySelector("#app").innerHTML=Y();function O(n,c,a){let i=new FileReader;i.readAsDataURL(n),i.onloadend=function(){let r=document.createElement("div");r.classList.add("img-container");let l=document.createElement("img");l.src=i.result,l.id=n.lastModified,r.append(l);let g=document.createElement("div");g.classList.add("trash"),g.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                                <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/>
                            </svg>`,g.addEventListener("click",a),r.append(g),c.appendChild(r)}}function N(n,c,a,i){let r=document.querySelector("#app"),l=new FileReader;l.readAsDataURL(n),l.onloadend=async function(){let g=document.createElement("div");g.classList.add("img-container");let y=document.createElement("img");y.src=l.result;let E=document.createElement("img");i==="textWattermark"?E.src=s(y,a):i==="logoWattermark"&&(E.src=await h(y,a)),E.id=n.lastModified,g.append(E);let w=document.createElement("div");w.classList.add("eye"),w.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                <path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/>
            </svg>
        `,w.addEventListener("click",()=>{let o=document.createElement("div");o.id="bigImgContainer";let m=document.createElement("img");m.src=E.src,m.id="bigImg";let d=document.createElement("a");d.id="closeBigImg",d.innerText="x",d.addEventListener("click",()=>{r.removeChild(o)}),o.append(m,d),r.appendChild(o)}),g.append(w);function s(o,m){const{text:d,fontSize:L,transparency:x,position:S}=m,v=document.createElement("canvas"),t=v.getContext("2d"),u=o.width,f=o.height;switch(v.width=u,v.height=f,t.drawImage(o,0,0,u,f),t.fillStyle=`rgba(255, 225, 225, ${x/100})`,t.font=`bold ${L}pt sans-serif`,S){case"Сверху слева":t.textAlign="start",t.fillText(d,30,40);break;case"Сверху посередине":t.textAlign="center",t.fillText(d,u/2,40);break;case"Сверху справа":t.textAlign="end",t.fillText(d,u-30,40);break;case"Посередине слева":t.textAlign="start",t.fillText(d,30,f/2);break;case"Посередине":t.textAlign="center",t.fillText(d,u/2,f/2);break;case"Посередине справа":t.textAlign="end",t.fillText(d,u-30,f/2);break;case"Снизу слева":t.textAlign="start",t.fillText(d,30,f-40);break;case"Снизу посередине":t.textAlign="center",t.fillText(d,u/2,f-40);break;case"Снизу справа":t.textAlign="end",t.fillText(d,u-30,f-40);break}return v.toDataURL()}async function h(o,m){const{logo:d,size:L,transparency:x,position:S}=m,v=document.createElement("canvas"),t=v.getContext("2d"),u=o.width,f=o.height;v.width=u,v.height=f,t.drawImage(o,0,0,u,f);const k=await(await fetch(d==null?void 0:d.currentSrc)).blob(),p=await createImageBitmap(k,{resizeHeight:L}),b=t.createPattern(p,"no-repeat");switch(S){case"Сверху слева":t.translate(10,10);break;case"Сверху посередине":t.translate(u/2-p.width/2,10);break;case"Сверху справа":t.translate(u-p.width-10,10);break;case"Посередине слева":t.translate(10,f/2-p.height/2);break;case"Посередине":t.translate(u/2-p.width/2,f/2-p.height/2);break;case"Посередине справа":t.translate(u-p.width-10,f/2-p.height/2);break;case"Снизу слева":t.translate(10,f-p.height-10);break;case"Снизу посередине":t.translate(u/2-p.width/2,f-p.height-10);break;case"Снизу справа":t.translate(u-p.width-10,f-p.height-10);break}return t.rect(0,0,u,f),t.fillStyle=b,t.globalAlpha=x/100,t.fill(),v.toDataURL()}c.appendChild(g)}}const Z=["/adding-watermarks-js/logo-1.png","/adding-watermarks-js/logo-2.png","/adding-watermarks-js/logo-3.png","/adding-watermarks-js/logo-4.png","/adding-watermarks-js/logo-5.png","/adding-watermarks-js/logo-6.png","/adding-watermarks-js/logo-7.png","/adding-watermarks-js/logo-8.png"],_=n=>{let c=document.querySelector("#app"),a=document.createElement("div");a.id="editMenu";let i=document.createElement("input");i.type="button",i.id="addTextBtn",i.value="Добавить текст";let r=document.createElement("input");r.type="button",r.id="addLogoBtn",r.value="Добавить логотип",l();function l(){a.appendChild(i),a.innerHTML+="<p>или</p>",a.appendChild(r),a.querySelector("#addTextBtn").addEventListener("click",g),a.querySelector("#addLogoBtn").addEventListener("click",y)}function g(){let s=document.createElement("input");s.type="text",s.id="textValue",s.placeholder="Ваш текст",E("textWattermark",s)}function y(){a.innerHTML="";let s=document.createElement("a");s.innerText="< Назад";let h=document.createElement("input");h.type="button",h.id="addLogoFromGallery",h.value="Выбрать из галереи";let o=document.createElement("label");o.classList.add("input-file");let m=document.createElement("input");m.type="file",m.accept="image/*";let d=document.createElement("span");d.innerText="Выбрать из файлов",o.append(m,d),a.append(s,h,o),a.querySelector("a").addEventListener("click",()=>{a.innerHTML="",l()}),a.querySelector("#addLogoFromGallery").addEventListener("click",w),m.addEventListener("change",L=>{var S;let x=new FileReader;x.readAsDataURL((S=L.target)==null?void 0:S.files[0]),x.onloadend=function(){let v=document.createElement("img");v.src=x.result,E("logoWattermark",v)}})}function E(s,h){a.innerHTML="";let o=document.createElement("a");o.innerText="< Назад";let m=document.createElement("form"),d=document.createElement("select");if(s==="textWattermark")for(let e=10;e<=42;e+=2)u(e,d,"pt");else if(s==="logoWattermark")for(let e=10;e<=300;e+=10)u(e,d,"px");let L=document.createElement("select");for(let e=10;e<=100;e+=10)u(e,L,"%");let x=document.createElement("select");["Сверху слева","Сверху посередине","Сверху справа","Посередине слева","Посередине","Посередине справа","Снизу слева","Снизу посередине","Снизу справа"].forEach(e=>{u(e,x)});let v=document.createElement("input");v.type="submit",v.value="Применить",s==="textWattermark"?m.append(t("Текст",h)):s==="logoWattermark"&&m.append(t("Выбранный логотип",h)),m.append(t("Размер",d),t("Прозрачность",L),t("Позиция",x),v),a.append(o,m),a.querySelector("a").addEventListener("click",()=>{a.innerHTML="",l()}),a.querySelector("form").addEventListener("submit",e=>{f(e,s,h)});function t(e,k){let p=document.createElement("div");p.classList.add("setting");let b=document.createElement("p");return b.innerText=e,p.append(b,k),p}function u(e,k,p=""){let b=document.createElement("option");b.value=e,b.innerText=`${e}${p}`,k.appendChild(b)}function f(e,k,p){var F,q,I,D,P,W,$;e.preventDefault();let b={};k==="textWattermark"?b={text:((F=e==null?void 0:e.target[0])==null?void 0:F.value)||"Ваш текст",fontSize:(q=e==null?void 0:e.target[1])==null?void 0:q.value,transparency:(I=e==null?void 0:e.target[2])==null?void 0:I.value,position:(D=e==null?void 0:e.target[3])==null?void 0:D.value}:k==="logoWattermark"&&(b={logo:p,size:(P=e==null?void 0:e.target[0])==null?void 0:P.value,transparency:(W=e==null?void 0:e.target[1])==null?void 0:W.value,position:($=e==null?void 0:e.target[2])==null?void 0:$.value});let A=document.querySelector("#editGallery");A.innerHTML="",n.forEach(J=>N(J,A,b,k))}}function w(){let s=document.createElement("div");s.classList.add("logo-outer-container");let h=document.createElement("div");h.id="logoContainer";let o=document.createElement("a");o.innerText="x",Z.forEach(m=>{let d=document.createElement("div");d.classList.add("logo-btn");let L=document.createElement("img");L.src=m,L.height="70",d.appendChild(L),h.appendChild(d)}),o.addEventListener("click",()=>{c.removeChild(s)}),h.addEventListener("click",m=>{E("logoWattermark",m==null?void 0:m.target),c.removeChild(s)}),s.append(h,o),c.appendChild(s)}return a};function K(){let n=document.querySelector("#app"),c=document.createElement("div");c.innerHTML='<div class="lds-ring"><div></div><div></div><div></div><div></div></div>',c.id="spinner",n.appendChild(c)}function V(){let n=document.querySelector("#app");n.removeChild(n.querySelector("#spinner"))}const ee=(n,c={text:"",fontSize:0,transparency:0,position:0})=>{let a=document.createElement("div");a.innerHTML=`
        <div id="editHeaderContainer">
            <div id="editHeader"></div>
        </div>    
        <div id="editContentContainer">
            <div id="editContent"></div>
        </div>

    `;let i=document.createElement("a");i.innerText="< Назад";let r=document.createElement("button");r.id="downloadFiles",r.innerText="Скачать файлы",K();let l=document.createElement("div");l.id="editGallery",n.forEach(y=>N(y,l,c,"textWattermark")),V(),a.querySelector("#editHeader").append(i,r),a.querySelector("#editContent").append(l,_(n)),a.querySelector("#editHeader a").addEventListener("click",()=>{location.reload()}),a.querySelector("#downloadFiles").addEventListener("click",()=>{document.querySelectorAll(".img-container>img").forEach((E,w)=>{g(E==null?void 0:E.currentSrc,`img-${w+1}`).then(()=>{console.log("The image has been downloaded")}).catch(s=>{console.log("Error downloading image: ",s)})})});async function g(y,E="my-image.png"){const s=await(await fetch(y)).blob(),h=URL.createObjectURL(s),o=document.createElement("a");o.href=h,o.download=E,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(h)}return a};let T=document.getElementById("drop-area"),te=document.getElementById("fileElem"),R=document.getElementById("maxCountOfPhoto"),z=document.getElementById("formAction"),B=document.getElementById("gallery"),H=document.getElementById("nextBtn"),j=document.querySelector("#app");te.addEventListener("change",M);H.addEventListener("click",ie);let C=[];["dragenter","dragover","dragleave","drop"].forEach(n=>{T.addEventListener(n,U,!1),document.body.addEventListener(n,U,!1)});["dragenter","dragover"].forEach(n=>{T.addEventListener(n,ne,!1)});["dragleave","drop"].forEach(n=>{T.addEventListener(n,ae,!1)});T.addEventListener("drop",re,!1);function U(n){n.preventDefault(),n.stopPropagation()}function ne(){T.classList.add("highlight")}function ae(){T.classList.remove("highlight")}function re(n){let a=n.dataTransfer.files;M(a)}function M(n){var a;let c=[];if(n!=="delete"){let i;"target"in n?i=(a=n.target)==null?void 0:a.files:i=n,i=[...i],i.forEach(r=>{C.length<9&&(C.push(r),c.push(r))})}C.length>=9?(R.style.display="block",z.style.display="none"):(R.style.display="none",z.style.display="block"),C.length>0?H.disabled=!1:H.disabled=!0,K(),n!=="delete"?c.forEach(i=>O(i,B,G)):(B.innerHTML="",C.forEach(i=>O(i,B,G))),V()}function G(n){var a,i,r,l,g;n.preventDefault();const c=(g=(l=(r=(i=(a=n==null?void 0:n.target)==null?void 0:a.parentNode)==null?void 0:i.parentNode)==null?void 0:r.parentNode)==null?void 0:l.childNodes[0])==null?void 0:g.id;C.splice(C.findIndex(y=>y.lastModified==c),1),M("delete")}function ie(){j.innerHTML="",j.appendChild(ee(C))}
